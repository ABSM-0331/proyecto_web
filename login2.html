<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro | Gamer Zone</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="css/style.css"> 

    <style>
        /* Estilos espec√≠ficos para la p√°gina de registro/login */
        body {
            background-color: #1a1a1a; 
            color: #f0f0f0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .login-container {
            flex-grow: 1; 
            display: flex;
            align-items: center; 
            justify-content: center; 
            padding: 40px 0;
        }

        /* La tarjeta ahora es m√°s ancha para incluir nombres y apellidos */
        .login-card {
            background-color: #121212; 
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            max-width: 550px; 
            width: 100%;
        }

        .login-card h2 {
            color: #ff9800; 
            margin-bottom: 30px;
            font-weight: bold;
            text-align: center;
        }

        .form-control {
            background-color: #2c2c2c;
            border: 1px solid #444;
            color: #f0f0f0;
        }
        
        .btn-accept {
            background-color: #ff9800;
            border-color: #ff9800;
            color: #121212;
            font-weight: bold;
        }
        .btn-accept:hover {
            background-color: #ffb74d; 
            border-color: #ffb74d;
        }
        
        /* Estilos para el Modal (Ventana emergente) */
        .modal-content {
            background-color: #121212;
            color: #f0f0f0; /* Color general del texto del modal */
            border: 1px solid #ff9800;
        }
        .modal-header {
            border-bottom: 1px solid #ff9800;
        }
        .modal-title {
            color: #ff9800;
        }
        .modal-body strong, .modal-body p { 
            color: #f0f0f0; /* Asegura que el texto normal sea blanco */
        }
        .modal-body .text-warning-custom { /* Clase para el nombre de usuario */
            color: #ffb74d !important; /* Color naranja claro */
            font-size: 1.1em;
        }
        .btn-close {
            filter: invert(1);
        }
    </style>
</head>

<body>
    <div class="alumnos-info container-fluid">
        <div class="container">
            <p>Proyecto de Dise√±o Web. Alumnos:</p>
            <p>Jorge Rafid Medina Porras | Miguel Moises Olivares Novelo | Rudy Daniel Navarrete Catzin</p>
        </div>
    </div>

    <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
        <div class="container">
            <a class="navbar-brand" href="inicio.html">üéÆ Gamer Zone</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="inicio.html">Inicio</a></li>
                    <li class="nav-item"><a class="nav-link" href="productos.html">Productos</a></li>
                    <li class="nav-item"><a class="nav-link" href="noticias.html">Noticias</a></li>
                    <li class="nav-item"><a class="nav-link" href="ofertas.html">Ofertas</a></li>
                    <li class="nav-item"><a class="nav-link" href="sobre-nosotros.html">Sobre Nosotros</a></li>
                    <li class="nav-item">
                         <a class="nav-link active" href="login2.html"><i class="bi bi-person-fill"></i> Registrarme</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link position-relative" href="carrito.html">
                            <i class="bi bi-cart-fill"></i> Carrito
                            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                                3 
                                <span class="visually-hidden">items en el carrito</span>
                            </span>
                        </a>
                    </li> 
                </ul>
            </div>
        </div>
    </nav>
    
    <div class="login-container">
        <div class="login-card animate-on-scroll is-visible">
            <h2>üìù Crear Cuenta</h2>
            
            <form id="registroForm">
                
                <h4 class="text-warning mb-3"><i class="bi bi-person-fill me-2"></i> Datos de la Cuenta</h4>
                
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="nombres" class="form-label">Nombres</label>
                        <input type="text" class="form-control" id="nombres" required>
                    </div>
                    <div class="col-md-6">
                        <label for="apellidos" class="form-label">Apellidos</label>
                        <input type="text" class="form-control" id="apellidos" required>
                    </div>
                </div>

                <div class="mb-3">
                    <label for="email" class="form-label">Correo Electr√≥nico</label>
                    <input type="email" class="form-control" id="email" required> 
                </div>

                <div class="mb-4">
                    <label for="password" class="form-label">Contrase√±a</label>
                    <input type="password" class="form-control" id="password" required minlength="8">
                </div>
                
                <button type="submit" class="btn btn-accept w-100">Registrarme</button>
                
                </form>
        </div>
    </div>

    <div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="successModalLabel"><i class="bi bi-check-circle-fill me-2"></i> ¬°Registro Exitoso!</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p class="text-success-custom">‚úÖ **¬°Tu cuenta ha sido creada con √©xito!**</p>
            <p>Ahora puedes iniciar sesi√≥n con tu correo electr√≥nico y contrase√±a.</p>
            <hr>
            <p>Bienvenido/a: <strong id="modalNombre" class="text-warning-custom"></strong></p> 
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-accept" data-bs-dismiss="modal">Aceptar y Continuar</button>
          </div>
        </div>
      </div>
    </div>
    
    <footer class="footer mt-auto">
        <div class="container">
            <div class="row">
                <div class="col-md-4 mb-3">
                    <h5>üéÆ Gamer Zone</h5>
                    <p>La mejor tienda online de videojuegos y accesorios.</p>
                    <p><i class="bi bi-geo-alt-fill me-2"></i> Calle Principal #123, Ciudad Gamer</p>
                </div>
                <div class="col-md-4 mb-3">
                    <h5>Enlaces R√°pidos</h5>
                    <ul class="list-unstyled">
                        <li><a href="productos.html" class="text-white text-decoration-none">Cat√°logo Completo</a></li>
                        <li><a href="ofertas.html" class="text-white text-decoration-none">Ver Ofertas</a></li>
                        <li><a href="noticias.html" class="text-white text-decoration-none">√öltimas Noticias</a></li>
                        <li><a href="sobre-nosotros.html" class="text-white text-decoration-none">Sobre Nosotros</a></li>
                        <li><a href="login-iniciar.html" class="text-white text-decoration-none">Mi Cuenta</a></li>
                    </ul>
                </div>
                <div class="col-md-4 mb-3">
                    <h5>S√≠guenos</h5>
                    <a href="#" class="text-white me-3"><i class="bi bi-facebook fs-4"></i></a>
                    <a href="#" class="text-white me-3"><i class="bi bi-twitter fs-4"></i></a>
                    <a href="#" class="text-white"><i class="bi bi-instagram fs-4"></i></a>
                </div>
            </div>
            <div class="row">
                <div class="col-12 text-center pt-3 border-top border-light opacity-50">
                    <p class="mb-0">&copy; 2025 Gamer Zone. Todos los derechos reservados. | Proyecto de Dise√±o Web.</p>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/sesion.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const registroForm = document.getElementById('registroForm'); 
            const successModal = new bootstrap.Modal(document.getElementById('successModal'));

            if (registroForm) {
                registroForm.addEventListener('submit', async (e) => {
                    e.preventDefault(); 

                    const nombres = document.getElementById('nombres').value;
                    const apellidos = document.getElementById('apellidos').value;
                    const email = document.getElementById('email').value; 
                    const password = document.getElementById('password').value; 
                                                        
                    const data = { 
                        nombres, 
                        apellidos, 
                        email, 
                        password, 
                        // Enviamos campos nulos o vac√≠os para /registro (ya que solo es REGISTRO, no compra)
                        direccion: null,
                        nombre_titular_tarjeta: null, 
                        numero_tarjeta: null, 
                        caducidad_tarjeta: null, 
                        cvv_tarjeta: null
                    };

                    try {
                        // Enviamos todos los datos a la ruta /registro (maneja INSERT)
                        const response = await fetch('http://localhost:3000/registro', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(data),
                        });

                        const result = await response.json();
                        
                        // Si es un registro nuevo, el status debe ser 201 (creaci√≥n)
                        if (response.status === 201) { 
                            
                            // 1. Rellenar los datos en el Modal
                            const nombreCompletoUsuario = result.nombre_completo || `${nombres} ${apellidos}`;
                            
                            document.getElementById('modalNombre').textContent = nombreCompletoUsuario;
                            
                            // 2. Ocultar el formulario y mostrar el Modal
                            document.querySelector('.login-card').style.display = 'none';
                            successModal.show();
                            
                            // 3. Guardar sesi√≥n
                            localStorage.setItem('usuarioNombre', nombreCompletoUsuario);
                            localStorage.setItem('sesionIniciada', 'true');
                            localStorage.setItem('usuarioEmail', email); 
                            
                        } else {
                            // Errores como email duplicado o falta de campo
                            alert('‚ùå Error al registrar la cuenta: ' + result.message);
                        }

                    } catch (error) {
                        console.error('Error de conexi√≥n con el servidor:', error);
                        alert('‚ùå Error de conexi√≥n. Aseg√∫rate que el servidor Express.js est√© corriendo en el puerto 3000.');
                    }
                });
            }

            // Evento para redirigir a inicio.html cuando el modal se cierra 
            document.getElementById('successModal').addEventListener('hidden.bs.modal', function () {
                if (registroForm) {
                    registroForm.reset();
                }
                // Redirigir al inicio despu√©s de un registro exitoso
                window.location.href = 'inicio.html'; 
            });
        });
    </script>
</body>
</html>